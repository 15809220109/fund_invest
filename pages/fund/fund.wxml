<!-- pages/fund/fund.wxml -->
<view class="container {{showDetails ? 'details-expanded' : ''}} {{pageTransitioning ? 'page-transitioning' : ''}}">
  <!-- åŸºé‡‘ä¿¡æ¯ - æ”¾åœ¨æœ€ä¸Šæ–¹ -->
  <view class="portfolio-summary">
    <!-- ç¬¬ä¸€è¡Œï¼šç°é‡‘å’ŒåŸºé‡‘ -->
    <view class="cash-fund-row">
      <view class="cash-block">
        <text class="label">ç°é‡‘</text>
        <text class="value">Â¥{{displayData.cash}}</text>
      </view>
      <view class="fund-block">
        <text class="label">åŸºé‡‘</text>
        <text class="value">Â¥{{displayData.fundValue}}</text>
      </view>
    </view>
    
    <!-- ç¬¬äºŒè¡Œï¼šæ”¶ç›Šä¿¡æ¯ -->
    <view class="profit-row">
      <view class="profit-block">
        <text class="label">å½“æ—¥ç›ˆäº</text>
        <text class="value {{_rawData.dailyProfit >= 0 ? 'profit' : 'loss'}}">{{displayData.dailyProfit}}</text>
      </view>
      <view class="profit-block">
        <text class="label">æŒä»“æ”¶ç›Š</text>
        <text class="value {{_rawData.totalProfit >= 0 ? 'profit' : 'loss'}}">{{displayData.totalProfit}}</text>
      </view>
      <view class="profit-block">
        <text class="label">æŒä»“æ”¶ç›Šç‡</text>
        <text class="value {{_rawData.profitRate >= 0 ? 'profit' : 'loss'}}">{{displayData.profitRate}}</text>
      </view>
    </view>
    
    <!-- ç¬¬ä¸‰è¡Œï¼šå¯æŠ˜å è¯¦æƒ… -->
    <view class="details-header" bindtap="toggleDetails">
      <text>è¯¦ç»†ä¿¡æ¯</text>
      <text>{{showDetails ? 'æ”¶èµ·' : 'å±•å¼€'}}</text>
    </view>
    
    <view class="details-content" wx:if="{{showDetails}}">
      <view class="details-row">
        <text class="label">æ—¥æ¶¨å¹…</text>
        <text class="value {{_rawData.dailyChange >= 0 ? 'profit' : 'loss'}}">{{displayData.dailyChange}}</text>
      </view>
      <view class="details-row">
        <text class="label">æœ€æ–°å‡€å€¼</text>
        <text class="value">{{displayData.currentNetValue}}</text>
      </view>
      <view class="details-row">
        <text class="label">æŒä»“æˆæœ¬</text>
        <text class="value">{{displayData.avgCost}}</text>
      </view>
      <view class="details-row">
        <text class="label">æŒä»“ä»½é¢</text>
        <text class="value">{{displayData.fundUnits}}</text>
      </view>
      <view class="details-row">
        <text class="label">ç´¯è®¡æ”¶ç›Šç‡</text>
        <text class="value {{_rawData.totalProfitRate >= 0 ? 'profit' : 'loss'}}">{{displayData.totalProfitRate}}</text>
      </view>
      <view class="details-row total-assets-row">
        <text class="label">æ€»èµ„äº§</text>
        <text class="value">Â¥{{displayData.totalAssets}}</text>
      </view>
    </view>
  </view>

  <!-- äº¤æ˜“æ—¥å€’è®¡æ—¶æç¤ºæ¡ -->
  <view class="countdown-bar {{!showDetails ? 'countdown-collapsed' : ''}} {{countdownUrgent ? 'urgent' : ''}}" 
        style="background-color: {{countdownBackgroundColor}}; box-shadow: 0 4rpx 15rpx {{countdownShadowColor}}; --shadow-color: {{countdownShadowColor}};">
    <!-- å±•å¼€è¯¦ç»†ä¿¡æ¯æ—¶æ˜¾ç¤ºå®Œæ•´å†…å®¹ -->
          <view class="countdown-content" wx:if="{{showDetails}}">
        <view class="countdown-icon" style="color: {{countdownTextColor}};">â°</view>
        <view class="countdown-text">
          <text class="countdown-label" style="color: {{countdownTextColor}};">{{remainingDaysLabel || 'å‰©ä½™äº¤æ˜“æ—¥'}}</text>
          <text class="countdown-number" style="color: {{countdownTextColor}};">{{remainingDaysText || remainingDays}}</text>
          <text class="countdown-unit" style="color: {{countdownTextColor}};">{{remainingDaysUnit}}</text>
        </view>
      </view>
          <!-- æŠ˜å çŠ¶æ€æ—¶åªæ˜¾ç¤ºè¿›åº¦æ¡ -->
      <view class="countdown-progress" style="background-color: {{countdownProgressBgColor}};">
        <view class="countdown-progress-fill" style="width: {{progressPercent}}%; background: {{countdownProgressBarColor}};"></view>
      </view>
  </view>

  <!-- å›¾è¡¨å¡ç‰‡ï¼ˆæ•´åˆæ—¶é—´é€‰æ‹©æŒ‰é’®ï¼‰ -->  
  <view class="chart-card" wx:if="{{showChart}}">    
    <view class="chart-container">
      <ec-canvas id="mychart-dom-fund" canvas-id="mychart-fund" ec="{{ ec }}" style="z-index: {{echartsZIndex}};" type="2d"></ec-canvas>  
    </view>
    
    <!-- æ—¶é—´å‘¨æœŸé€‰æ‹©æŒ‰é’® - æ•´åˆåˆ°å›¾è¡¨å¡ç‰‡åº•éƒ¨ -->
    <view class="time-period-buttons">
      <view class="period-btn {{timePeriod === '1m' ? 'active' : ''}}" bindtap="changePeriod" data-period="1m">è¿‘1æœˆ</view>
      <view class="period-btn {{timePeriod === '3m' ? 'active' : ''}}" bindtap="changePeriod" data-period="3m">è¿‘3æœˆ</view>
      <view class="period-btn {{timePeriod === '6m' ? 'active' : ''}}" bindtap="changePeriod" data-period="6m">è¿‘6æœˆ</view>
      <view class="period-btn {{timePeriod === '1y' ? 'active' : ''}}" bindtap="changePeriod" data-period="1y">è¿‘1å¹´</view>
    </view>
  </view>

  <!-- äº¤æ˜“è®°å½•å¡ç‰‡ - å½“å±•å¼€è¯¦ç»†ä¿¡æ¯æ—¶éšè— -->
  <view class="trading-history-card" wx:if="{{!showDetails}}">
    <view class="trading-history-header">
      <view class="history-title">
        <text class="title-icon">ğŸ“‹</text>
        <text class="title-text">äº¤æ˜“è®°å½•</text>
      </view>
      <view class="history-summary">
        <text class="summary-text">å…±{{reversedTradingHistory.length}}ç¬”äº¤æ˜“</text>
      </view>
    </view>
    
    <view class="trading-history-list">
      <!-- æœ‰äº¤æ˜“è®°å½•æ—¶æ˜¾ç¤ºåˆ—è¡¨ -->
      <view wx:if="{{reversedTradingHistory.length > 0}}">
        <view class="trading-item" wx:for="{{reversedTradingHistory}}" wx:key="index" wx:for-index="idx">
          <view class="trading-type {{item.type === 'buy' ? 'buy-type' : 'sell-type'}}">
            <text class="type-icon">{{item.type === 'buy' ? 'ğŸ’°' : 'ğŸ’¸'}}</text>
            <text class="type-text">{{item.type === 'buy' ? 'ä¹°å…¥' : 'å–å‡º'}}</text>
          </view>
          <text class="detail-text detail-units">ä»½é¢ {{item.displayUnits}}</text>
          <view class="trading-net-value">
            <text class="net-value-text">å‡€å€¼ {{item.displayNetValue}}</text>
          </view>
          <text class="detail-text detail-amount">é‡‘é¢ {{item.displayAmount}}</text>
        </view>
      </view>
      
      <!-- ç©ºçŠ¶æ€æç¤º -->
      <view class="empty-state" wx:else>
        <text class="empty-icon">ğŸ’¼</text>
        <text class="empty-text">æš‚æ— äº¤æ˜“è®°å½•</text>
        <text class="empty-desc">å¼€å§‹æ‚¨çš„ç¬¬ä¸€ç¬”æŠ•èµ„å§ï¼</text>
      </view>
    </view>
  </view>

  <!-- æ¸¸æˆç»“æŸåçš„æ€»ç»“å¡ç‰‡ -->
  <view class="game-end-summary" wx:if="{{gameEnded && !showChart}}">
    <view class="summary-icon">ğŸ“ˆ</view>
    <view class="summary-title">{{gameTexts.CHALLENGE_COMPLETED}}</view>
    <view class="summary-desc">ç‚¹å‡»æŸ¥çœ‹æ‚¨çš„æŠ•èµ„æˆæœï¼</view>
  </view>
  
  <!-- æ‚¬æµ®æ“ä½œæŒ‰é’® -->
  <view class="floating-actions">
    <!-- æ¸¸æˆå®ŒæˆçŠ¶æ€ï¼šæ˜¾ç¤º"æŸ¥çœ‹æŠ•èµ„æˆæœ"æŒ‰é’® -->
    <view wx:if="{{showCompletionButton || isLastDayCompleted}}" class="share-finish-container">
      <button class="share-finish-btn" bindtap="showShareAndFinish">
        <view class="share-btn-icon">ğŸ‰</view>
        <view class="share-btn-text">æŸ¥çœ‹æŠ•èµ„æˆæœ</view>
      </button>
    </view>
    
    <!-- æ­£å¸¸æ¸¸æˆçŠ¶æ€ï¼šæ˜¾ç¤ºä¸‰ä¸ªæ“ä½œæŒ‰é’® -->
    <view wx:else class="normal-actions">
      <button class="floating-btn sell-btn {{sellPressed ? 'pressed' : ''}} {{gameEnded ? 'disabled' : ''}}" bindtouchstart="onBtnTouchStart" bindtouchend="onBtnTouchEnd" bindtap="navigateToSellPage" data-type="sell" disabled="{{gameEnded}}">å–å‡º</button>
      <button class="floating-btn next-btn {{nextPressed ? 'pressed' : ''}} {{gameEnded ? 'disabled' : ''}}" bindtouchstart="onBtnTouchStart" bindtouchend="onBtnTouchEnd" bindtap="nextDay" data-type="next" disabled="{{gameEnded}}">ä¸‹ä¸€æ—¥</button>
      <button class="floating-btn buy-btn {{buyPressed ? 'pressed' : ''}} {{gameEnded ? 'disabled' : ''}}" bindtouchstart="onBtnTouchStart" bindtouchend="onBtnTouchEnd" bindtap="navigateToBuyPage" data-type="buy" disabled="{{gameEnded}}">ä¹°å…¥</button>
    </view>
  </view>
</view> 