<!--pages/login/login.wxml-->
<view class="login-container">
  <view class="header">
    <!-- ç”¨æˆ·å¤´åƒï¼Œå¦‚æœæ²¡æœ‰åˆ™æ˜¾ç¤ºé»˜è®¤å¤´åƒ -->
    <view wx:if="{{userInfo && userInfo.avatarUrl}}" class="user-avatar-container" bindtap="onAvatarTap">
      <image 
        class="user-avatar" 
        src="{{userInfo.avatarUrl}}" 
        mode="aspectFill"
        bindload="onAvatarLoad"
        binderror="onAvatarError"
      ></image>
    </view>
    <view wx:else class="user-avatar-container" bindtap="onAvatarTap">
      <view class="default-avatar">ğŸ‘¤</view>
    </view>
    <text class="title">å…»åŸºé«˜æ‰‹</text>
    <text class="subtitle">ä»¥æ¸¸æˆçš„å§¿æ€å­¦ä¹ æŠ•èµ„</text>
  </view>

  <view class="content">
    <view class="features">
      <view class="feature-item">
        <view class="feature-icon">ğŸ’°</view>
        <text class="feature-text">æ¨¡æ‹ŸæŠ•èµ„</text>
        <text class="feature-desc">è½»æ¾åšäº¤æ˜“ï¼Œé›¶æˆæœ¬ç©è½¬æŠ•èµ„</text>
      </view>
      <view class="feature-item">
        <view class="feature-icon">ğŸ“Š</view>
        <text class="feature-text">çœŸå®æ•°æ®</text>
        <text class="feature-desc">å†å²æ•°æ®å›æ”¾ï¼Œè¿˜åŸçœŸå®å¸‚åœº</text>
      </view>
      <view class="feature-item">
        <view class="feature-icon">ğŸ“±</view>
        <text class="feature-text">äº‘ç«¯åŒæ­¥</text>
        <text class="feature-desc">éšæ—¶éšåœ°ï¼Œç»§ç»­ä½ çš„æŠ•èµ„ä¹‹æ—…</text>
      </view>
    </view>

    <!-- ä¸»è¦æ“ä½œæŒ‰é’® -->
    <view class="main-actions">
      <button 
        class="start-btn" 
        bindtap="startInvestment"
        type="primary"
        loading="{{isLogging}}"
      >
        {{isLogging ? 'ç™»å½•ä¸­...' : (hasStartedSession ? 'ç»§ç»­æŠ•èµ„' : 'å¼€å§‹æŠ•èµ„')}}
      </button>
    </view>

    <!-- å·²ç™»å½•ç”¨æˆ·çš„é¢å¤–æ“ä½œ -->
    <view wx:if="{{isLoggedIn}}" class="secondary-actions">
      <view class="action-buttons">
        <button 
          class="secondary-btn restart-btn" 
          bindtap="restartGame"
          type="default"
        >
          é‡æ–°å¼€å§‹
        </button>

        <button 
          class="secondary-btn share-preview-btn" 
          bindtap="showSharePreview"
          type="default"
        >
          æˆ‘çš„æˆ˜ç»©
        </button>
      </view>
    </view>
  </view>

  <view class="footer">
    <text class="footer-text">æ•°æ®ä»…ä¾›å­¦ä¹ å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®</text>
  </view>

  <!-- ç™»å½•æç¤ºå¼¹çª— -->
  <view class="login-modal-mask" wx:if="{{showLoginModal}}" bindtap="closeLoginModal">
    <view class="login-modal" catchtap="">
      <view class="modal-header">
        <view class="modal-icon">ğŸ”</view>
        <view class="modal-title">ç™»å½•æç¤º</view>
      </view>
      
      <view class="modal-content">
        <text class="modal-text">ç™»å½•åå¯ä¿å­˜æ‚¨çš„æŠ•èµ„æ•°æ®åˆ°äº‘ç«¯</text>
        <text class="modal-sub-text">éšæ—¶éšåœ°æŸ¥çœ‹æŠ•èµ„è®°å½•å’Œæ’å</text>
      </view>
      
      <view class="modal-actions">
        <button class="modal-btn cancel-btn" bindtap="closeLoginModal">
          å–æ¶ˆ
        </button>
        <button class="modal-btn confirm-btn" bindtap="oneClickLogin">
          ä¸€é”®ç™»å½•
        </button>
      </view>
      
      <view class="modal-close" bindtap="closeLoginModal">Ã—</view>
    </view>
  </view>

  <!-- æ¸¸æˆç»“æœåˆ†äº«å¡ç‰‡ -->
  <view class="game-result-mask" wx:if="{{showGameResult}}">
    <view class="game-result-card" catchtap="">
      <!-- å¡ç‰‡å¤´éƒ¨ -->
      <view class="result-header">
        <view class="result-title">ğŸ‰ æŠ•èµ„æŒ‘æˆ˜å®Œæˆï¼</view>
      </view>

      <!-- æ ¸å¿ƒæ•°æ®å±•ç¤º -->
      <view class="result-stats">
        <view class="stat-item main-stat">
          <view class="stat-label">æ€»èµ„äº§</view>
          <view class="stat-value">Â¥{{gameEndData.finaltotalAssets}}</view>
          <view class="stat-secondary">ç´¯è®¡æ”¶ç›Šç‡: {{gameEndData.finalTotalProfitRate >= 0 ? '+' : ''}}{{gameEndData.finalTotalProfitRate}}%</view>
        </view>
        
        <view class="stat-row">
          <view class="stat-item">
            <view class="stat-label">æŒä»“æ”¶ç›Š</view>
            <view class="stat-value">{{gameEndData.currentRoundProfit >= 0 ? '+' : ''}}{{gameEndData.currentRoundProfit}}</view>
          </view>
          <view class="stat-item">
            <view class="stat-label">æŒä»“æ”¶ç›Šç‡</view>
            <view class="stat-value">{{gameEndData.currentRoundProfitRate >= 0 ? '+' : ''}}{{gameEndData.currentRoundProfitRate}}%</view>
          </view>
        </view>

        <view class="stat-row">
          <view class="stat-item">
            <view class="stat-label">äº¤æ˜“æ¬¡æ•°</view>
            <view class="stat-value">{{gameEndData.tradingCount}}æ¬¡</view>
          </view>
          <view class="stat-item">
            <view class="stat-label">æŠ•èµ„å¤©æ•°</view>
            <view class="stat-value">{{gameEndData.investmentDays}}å¤©</view>
          </view>
        </view>
      </view>

      <!-- æˆå°±è¯„çº§ -->
      <view class="achievement-section">
        <view class="achievement-container">
          <view class="achievement-badge {{gameEndData.achievementLevel}}">
            <view class="achievement-icon">{{gameEndData.achievementIcon}}</view>
            <view class="achievement-text">{{gameEndData.achievementTitle}}</view>
          </view>
          <view class="achievement-desc">{{gameEndData.achievementDesc}}</view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="result-actions">
        <button class="action-btn share-btn" open-type="share">
          <view class="btn-icon-wrapper">
            <view class="btn-icon">ğŸ“±</view>
          </view>
          <view class="btn-text">å¾®ä¿¡åˆ†äº«</view>
          <view class="btn-arrow">â†’</view>
        </button>
        
        <button class="action-btn ranking-btn" bindtap="goToRanking">
          <view class="btn-icon-wrapper">
            <view class="btn-icon">ğŸ†</view>
          </view>
          <view class="btn-text">æŸ¥çœ‹æ’å</view>
          <view class="btn-arrow">â†’</view>
        </button>
      </view>

      <!-- å…³é—­æŒ‰é’® -->
      <view class="close-btn" bindtap="closeGameResult">
        <view class="close-icon">âœ•</view>
      </view>
    </view>
  </view>
</view> 