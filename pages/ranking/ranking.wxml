<!--pages/ranking/ranking.wxml-->
<view class="ranking-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="ranking-header">
    <view class="header-background"></view>
    <view class="header-content">
      <view class="back-btn" bindtap="goBack">
        <text class="back-icon">â€¹</text>
      </view>
      <view class="header-title">
        <text class="title-main">æŠ•èµ„æ’è¡Œæ¦œ</text>
        <text class="title-sub">æ€»èµ„äº§æ’å</text>
      </view>
      <view class="header-spacer"></view>
    </view>
  </view>

  <!-- æˆ‘çš„æ’åå¡ç‰‡ -->
  <view class="my-ranking-card" wx:if="{{myRanking}}">
    <view class="my-rank-header">
      <view class="my-rank-info">
        <text class="my-rank-label">æˆ‘çš„æ’å</text>
        <text class="my-rank-name" wx:if="{{myRanking.nickname}}">{{myRanking.nickname}}</text>
      </view>
      <view class="rank-badge rank-{{myRanking.rank <= 3 ? 'top' : 'normal'}}">
        <text class="rank-number">ç¬¬{{myRanking.rank}}å</text>
        <view class="rank-crown" wx:if="{{myRanking.rank <= 3}}">{{myRanking.rank == 1 ? 'ğŸ‘‘' : myRanking.rank == 2 ? 'ğŸ¥ˆ' : 'ğŸ¥‰'}}</view>
      </view>
    </view>
    <view class="my-rank-stats">
      <view class="stat-item">
        <text class="stat-label">æ€»èµ„äº§</text>
        <text class="stat-value">Â¥{{myRanking.totalAssets}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">æ”¶ç›Šç‡</text>
        <text class="stat-value {{myRanking.profitRate >= 0 ? 'profit' : 'loss'}}">{{myRanking.profitRate >= 0 ? '+' : ''}}{{myRanking.profitRate}}%</text>
      </view>
    </view>
    <view class="my-rank-tip" wx:if="{{myRanking.rank <= 10}}">
      <text class="tip-text">ğŸ‰ æ­å–œè¿›å…¥å‰ååï¼</text>
    </view>
  </view>

  <!-- æœªä¸Šæ¦œæç¤º -->
  <view class="not-ranked-card" wx:if="{{!myRanking && !loading}}">
    <view class="not-ranked-content">
      <view class="not-ranked-icon">ğŸ“ˆ</view>
      <text class="not-ranked-title">å°šæœªä¸Šæ¦œ</text>
      <text class="not-ranked-desc">å®ŒæˆæŠ•èµ„æŒ‘æˆ˜åå³å¯å‚ä¸æ’å</text>
    </view>
  </view>

  <!-- æ’è¡Œæ¦œå†…å®¹ -->
  <view class="ranking-content">
    <!-- å‰ä¸‰åç‰¹æ®Šå±•ç¤º -->
    <view class="top-three" wx:if="{{rankingList.length > 0}}">
      <view class="podium">
        <!-- ç¬¬äºŒå -->
        <view class="podium-item second" wx:if="{{rankingList.length > 1}}">
          <view class="podium-rank">2</view>
          <view class="podium-avatar">
            <image src="{{rankingList[1].avatar}}" mode="aspectFill" wx:if="{{rankingList[1].avatar}}" binderror="onAvatarError" bindload="onAvatarLoad" data-openid="{{rankingList[1].openid}}" class="avatar-image"></image>
            <view class="default-avatar" wx:else>ğŸ‘¤</view>
            <view class="avatar-loading" wx:if="{{!rankingList[1].avatar && !loading}}"></view>
          </view>
          <text class="podium-name">{{rankingList[1].nickname}}</text>
          <text class="podium-amount">Â¥{{rankingList[1].totalAssets}}</text>
          <view class="podium-base second-base"></view>
        </view>

        <!-- ç¬¬ä¸€å -->
        <view class="podium-item first" wx:if="{{rankingList.length > 0}}">
          <view class="crown">ğŸ‘‘</view>
          <view class="podium-rank">1</view>
          <view class="podium-avatar">
            <image src="{{rankingList[0].avatar}}" mode="aspectFill" wx:if="{{rankingList[0].avatar}}" binderror="onAvatarError" bindload="onAvatarLoad" data-openid="{{rankingList[0].openid}}" class="avatar-image"></image>
            <view class="default-avatar" wx:else>ğŸ‘¤</view>
            <view class="avatar-loading" wx:if="{{!rankingList[0].avatar && !loading}}"></view>
          </view>
          <text class="podium-name">{{rankingList[0].nickname}}</text>
          <text class="podium-amount">Â¥{{rankingList[0].totalAssets}}</text>
          <view class="podium-base first-base"></view>
        </view>

        <!-- ç¬¬ä¸‰å -->
        <view class="podium-item third" wx:if="{{rankingList.length > 2}}">
          <view class="podium-rank">3</view>
          <view class="podium-avatar">
            <image src="{{rankingList[2].avatar}}" mode="aspectFill" wx:if="{{rankingList[2].avatar}}" binderror="onAvatarError" bindload="onAvatarLoad" data-openid="{{rankingList[2].openid}}" class="avatar-image"></image>
            <view class="default-avatar" wx:else>ğŸ‘¤</view>
            <view class="avatar-loading" wx:if="{{!rankingList[2].avatar && !loading}}"></view>
          </view>
          <text class="podium-name">{{rankingList[2].nickname}}</text>
          <text class="podium-amount">Â¥{{rankingList[2].totalAssets}}</text>
          <view class="podium-base third-base"></view>
        </view>
             </view>
    </view>

    <!-- æ’è¡Œæ¦œåˆ—è¡¨ -->
    <view class="ranking-list">
      <view class="list-header">
        <text class="list-title">å®Œæ•´æ’å</text>
        <text class="list-count">å…±{{rankingList.length}}ä½æŠ•èµ„è€…</text>
      </view>
      
      <view class="ranking-item {{item.isMe ? 'my-item' : ''}}" 
            wx:for="{{rankingList}}" 
            wx:key="id"
            wx:for-item="item"
            wx:for-index="index">
        <view class="item-rank">
          <view class="rank-circle rank-{{index < 3 ? 'top' : 'normal'}}">
            <text class="rank-text">{{index + 1}}</text>
          </view>
        </view>
        
        <view class="item-avatar">
          <image src="{{item.avatar}}" mode="aspectFill" wx:if="{{item.avatar}}" binderror="onAvatarError" bindload="onAvatarLoad" data-openid="{{item.openid}}" class="avatar-image"></image>
          <view class="default-avatar" wx:else>ğŸ‘¤</view>
          <view class="avatar-loading" wx:if="{{!item.avatar && !loading}}"></view>
          <view class="me-badge" wx:if="{{item.isCurrentUser}}">æˆ‘</view>
          <view class="custom-profile-badge" wx:if="{{item.hasCustomProfile}}">ğŸŒŸ</view>
        </view>
        
        <view class="item-info">
          <text class="item-name">{{item.nickname}}</text>
        </view>
        
        <view class="item-stats">
          <text class="item-amount">Â¥{{item.totalAssets}}</text>
          <text class="item-profit {{item.profitRate >= 0 ? 'profit' : 'loss'}}">{{item.profitRate >= 0 ? '+' : ''}}{{item.profitRate}}%</text>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{!loading && rankingList.length === 0}}">
        <view class="empty-icon">ğŸ“Š</view>
        <text class="empty-text">æš‚æ— æ’åæ•°æ®</text>
        <text class="empty-desc">å®ŒæˆæŠ•èµ„æŒ‘æˆ˜åå³å¯ä¸Šæ¦œ</text>
      </view>

      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading-state" wx:if="{{loading}}">
        <view class="loading-spinner"></view>
        <text class="loading-text">{{loadingText}}</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨è¯´æ˜ -->
  <view class="ranking-footer">
    <text class="footer-note">* æ’ååŸºäºæ€»èµ„äº§è®¡ç®—ï¼Œæ¯å°æ—¶æ›´æ–°ä¸€æ¬¡</text>
  </view>
</view> 